//Arduino Standard Library LEDControl
#include "LedControl.h"

LedControl lc=LedControl(8,9,10,2);
int ndev = 0;
const int index[16]={4,11,10,9,3,2,3,4,5,12,6,5,8,1,1,2};
const int chip[16]={1,0,0,0,1,0,0,0,0,0,1,1,0,0,1,1};
const char segs[16]={'u','t','s','r','p','n','m','k','h','g','f','e','d','c','b','a'};
const uint16_t SixteenSegmentASCII[96] = {
  0b0000000000000000, /* (space) */
  0b0000000000001100, /* ! */
  0b0000001000000100, /* " */
  0b1010101000111100, /* # */
  0b1010101010111011, /* $ */
  0b1110111010011001, /* % */
  0b1001001101110001, /* & */
  0b0000001000000000, /* ' */
  0b0001010000000000, /* ( */
  0b0100000100000000, /* ) */
  0b1111111100000000, /* * */
  0b1010101000000000, /* + */
  0b0100000000000000, /* , */
  0b1000100000000000, /* - */
  0b0001000000000000, /* . */
  0b0100010000000000, /* / */
  0b0100010011111111, /* 0 */
  0b0000010000001100, /* 1 */
  0b1000100001110111, /* 2 */
  0b0000100000111111, /* 3 */
  0b1000100010001100, /* 4 */
  0b1001000010110011, /* 5 */
  0b1000100011111011, /* 6 */
  0b0000000000001111, /* 7 */
  0b1000100011111111, /* 8 */
  0b1000100010111111, /* 9 */
  0b0010001000000000, /* : */
  0b0100001000000000, /* ; */
  0b1001010000000000, /* < */
  0b1000100000110000, /* = */
  0b0100100100000000, /* > */
  0b0010100000000111, /* ? */
  0b0000101011110111, /* @ */
  0b1000100011001111, /* A */
  0b0010101000111111, /* B */
  0b0000000011110011, /* C */
  0b0010001000111111, /* D */
  0b1000000011110011, /* E */
  0b1000000011000011, /* F */
  0b0000100011111011, /* G */
  0b1000100011001100, /* H */
  0b0010001000110011, /* I */
  0b0000000001111100, /* J */
  0b1001010011000000, /* K */
  0b0000000011110000, /* L */
  0b0000010111001100, /* M */
  0b0001000111001100, /* N */
  0b0000000011111111, /* O */
  0b1000100011000111, /* P */
  0b0001000011111111, /* Q */
  0b1001100011000111, /* R */
  0b1000100010111011, /* S */
  0b0010001000000011, /* T */
  0b0000000011111100, /* U */
  0b0100010011000000, /* V */
  0b0101000011001100, /* W */
  0b0101010100000000, /* X */
  0b1000100010111100, /* Y */
  0b0100010000110011, /* Z */
  0b0010001000010010, /* [ */
  0b0001000100000000, /* \ */
  0b0010001000100001, /* ] */
  0b0101000000000000, /* ^ */
  0b0000000000110000, /* _ */
  0b0000000100000000, /* ` */
  0b1010000001110000, /* a */
  0b1010000011100000, /* b */
  0b1000000001100000, /* c */
  0b0010100000011100, /* d */
  0b1100000001100000, /* e */
  0b1010101000000010, /* f */
  0b1010001010100001, /* g */
  0b1010000011000000, /* h */
  0b0010000000000000, /* i */
  0b0010001001100000, /* j */
  0b0011011000000000, /* k */
  0b0000000011000000, /* l */
  0b1010100001001000, /* m */
  0b1010000001000000, /* n */
  0b1010000001100000, /* o */
  0b1000001011000001, /* p */
  0b1010001010000001, /* q */
  0b1000000001000000, /* r */
  0b1010000010100001, /* s */
  0b1000000011100000, /* t */
  0b0010000001100000, /* u */
  0b0100000001000000, /* v */
  0b0101000001001000, /* w */
  0b0101010100000000, /* x */
  0b0000101000011100, /* y */
  0b1100000000100000, /* z */
  0b1010001000010010, /* { */
  0b0010001000000000, /* | */
  0b0010101000100001, /* } */
  0b1100110000000000, /* ~ */
  0b0000000000000000, /* (del) */
};

void setupSixteen()
{
  ndev = lc.getDeviceCount();
  for (int i = 0; i < ndev; i++)
  {
    lc.shutdown(i,false);
    /* Set the brightness to a medium values */
    lc.setIntensity(i,15);
    /* and clear the display */
    lc.clearDisplay(i);    
  }
}

void testSixteen(bool toggle)
{
  for(int digit=0; digit<ndev*2; digit++)
  {
    int digitOffset = 0;
    for(int i = 0; i < 16; i++)
    {
      int chipNum = chip[15-i];
      if (chipNum == 0)
      {
        digitOffset = digit*14;
      }
      else
      {
        digitOffset = digit*7;
      }
      int position = (index[15-i]+digitOffset);
      lc.setLed(chipNum, position/7, position%7, toggle); 
    }
  }
}
void printSixteen(char c, int digit)
{
  int digitOffset = 0;
  for(int i = 0; i < 16; i++)
  {
    int bitVal = (SixteenSegmentASCII[c-32]>>i)&0x01;
//    Serial.print("Char: ");
//    Serial.print(c);
//    Serial.print("\tChar Num: ");
//    Serial.print(int(c-32));
//    Serial.print("\tIndex: ");
//    Serial.print(i);
//    Serial.print("\tState: ");
//    Serial.print(bitVal);
//    Serial.print("\tChip: ");
//    Serial.print(chip[15-i]);
//    Serial.print("\tPin: ");
//    Serial.print(index[15-i]);
//    Serial.print("\tSeg: ");
//    Serial.println(segs[15-i]);
//    lc.setLed(chip[15-i], index[15-i]/7, index[15-i]%7, true); 
//    delay(50);
//    lc.setLed(chip[15-i], index[15-i]/7, index[15-i]%7, false); 
//    delay(50);
//    
    int chipNum = chip[15-i];
    if (chipNum == 0)
    {
      digitOffset = digit*14;
    }
    else
    {
      digitOffset = digit*7;
    }
    int position = (index[15-i]+digitOffset);
    lc.setLed(chipNum, position/7, position%7, bitVal); 
//    delay(5000);
  }
}
